<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="/assets/style.css">
  <meta http-equiv="X-UA-Compatible" content="ie=edge">
  <title>Pilosa Console</title>
</head>
<body>
  <div class="header">
    <img src="https://dc3kpxyuw05cb.cloudfront.net/img/logo.svg" width="110" alt="">
    <a href='/' >Support</a>
  </div>
  <div class="container">
    <div class="nav">
      <div class="nav-item nav-active">
        <img style='margin-bottom:10px;' height='40px' src="/assets/nav_console.svg" alt="">
        Console
      </div>
      <div class="nav-item">
        <img style='margin-bottom:10px;' height='20px' src="/assets/nav_cluster.svg" alt="">
        Cluster Admin
      </div>
      <div class="nav-item">
        <img style='margin-bottom:10px;' height='30px' src="/assets/nav_documentation.svg" alt="">
        Documentation
      </div>
    </div>
    <div class="interface">

      <div class="query">
        <h2>Query</h2>
        <textarea name="name" id='query' rows="5"  required></textarea>
        <div class='input-controls'>

          <select class="" name="">
            <option value="">Index</option>
          </select>
          &nbsp;&nbsp;&nbsp;
          <button  id='query-btn'>Run Query</button>
        </div>
      </div>


      <div  class="output-container">

        <h2>Output</h2>
        <div id="outputs">

          <!-- results -->
        </div>

      </div>



      </div>

    </div>
  </div>
  <script type="text/javascript">


  //helpers
  function prependChild(parent, newFirstChild) {
      parent.insertBefore(newFirstChild, parent.firstChild)
  }

  var createSingleOutput = function(res){
    var node = document.createElement("div");
    node.classList.add('output');
    var markup =`

      <div  class="panes">
        <div class="pane active">
          <div class="result-io">
            <div class="result-io-header">
              <h5>Input</h5>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <em>Source: Index</em>
            </div>
            <div class="result-input">
              ${res.input}
            </div>
          </div>
          <div class="result-io">
            <div class="result-io-header">
              <h5>output</h5>
              &nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
              <em>.42 ms</em>
            </div>
            <div class="result-ouput">
              ${res.output}
            </div>
          </div>
        </div>
        <div class="pane">
          <div class="raw">

            <a href="${res.url}">Export raw .csv</a>
          </div>
        </div>
      </div>

    `
    node.innerHTML = markup;

    prependChild(document.getElementById("outputs"),node);
  }





// mock data load
  var results=[
    {
      id:1,
      input:'Union(Bitmap(id=1, frame=“foo”), Bitmap(id=1), frame=“bar”))',
      output: '{“results”:[{“attrs”:bits”:[1,2,3,4,5,12,13,14]}]}',
    },
    {
      id:2,
      input:'SetBitmapAttrs(Bitmap(id=1, frame=“foo”), Bitmap(id=1), frame=“bar”))”))',
      output: 'null',
    }
  ]
  for (var i = 0; i < results.length; i++){
    createSingleOutput(results[i]);
  }




//mock api
function callAPI(){
  return {
    input:document.getElementById("query").value,
    output: `${queryBox.value} +1`

  }
}



  //events
  var button = document.getElementById('query-btn');
  var queryBox = document.getElementById("query")

  button.onclick = function(){
    var res = callAPI()
    createSingleOutput(res);
  }


queryBox.addEventListener("keyup", function(event) {
    event.preventDefault();
    if (event.key == 'Enter') {
        button.click();
    }
});







  </script>
</body>
</html>
